<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Localizador M√≥vel | Servi√ßo de Rastreamento</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Estilos Globais e Tema Escuro */
        body {
            background-color: #1e1e1e;
            color: #f0f0f0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* Container Principal do Formul√°rio e Mapa */
        .localizador-container {
            background-color: #2c2c2c;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* T√≠tulo */
        h2 {
            text-align: center;
            color: #79d2a6;
            margin-bottom: 25px;
            font-weight: 600;
        }

        /* Campo de Input Fixo */
        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin-bottom: 20px;
        }
        
        #numero {
            text-align: center;
            width: 80%;
            padding: 12px;
            border: 1px solid #555;
            border-radius: 6px;
            background-color: #383838;
            color: #f0f0f0;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        /* Bot√£o de A√ß√£o */
        button {
            padding: 12px 30px;
            background-color: #79d2a6;
            color: #1e1e1e;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        button:hover {
            background-color: #5cb887;
        }

        /* √Årea do Mapa */
        #map {
            height: 350px;
            width: 100%;
            border-radius: 8px;
            border: 2px solid #444;
            margin-top: 25px;
            display: none; 
        }

        /* Modal de Carregamento */
        .modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.85); /* Fundo mais escuro */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #1e1e1e;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 25px rgba(121, 210, 166, 0.2); /* Sombra verde */
            color: #f0f0f0;
            border: 1px solid #79d2a6;
        }

        /* Spinner de Carregamento (Mais profissional) */
        .loader {
            border: 4px solid #f3f3f340;
            border-top: 4px solid #79d2a6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .aviso {
            margin-top: 20px;
            padding: 10px;
            background-color: #383838;
            border-left: 4px solid #f9a825;
            border-radius: 4px;
            font-size: 0.8em;
            color: #bbb;
            width: 100%;
        }
    </style>
</head>
<body>

    <audio id="scanSound" src="https://assets.mixkit.co/sfx/preview/mixkit-scifi-scanner-2292.mp3" preload="auto"></audio>
    <audio id="confirmSound" src="https://assets.mixkit.co/sfx/preview/mixkit-positive-scan-beep-221.mp3" preload="auto"></audio>


    <div class="localizador-container">
        
        <h2><i class="fas fa-satellite-dish"></i> Localizador de Dispositivo M√≥vel</h2>
        
        <div class="input-group">
            <label>N√∫mero Alvo:</label>
            <input type="text" id="numero" value="+55 21 98149-3031" readonly>
            
            <button onclick="simularLocalizacao()">
                <i class="fas fa-crosshairs"></i> Localizar
            </button>
        </div>

        <div id="map"></div>

   

    </div>

    <div id="loadingModal" class="modal">
        <div class="modal-content">
            <div class="loader"></div>
            <h3>Triangulando Coordenadas...</h3>
            <p>Conectando-se ao sat√©lite e processando o sinal do dispositivo.</p>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // --- Constantes de Localiza√ß√£o ---
        const LATITUDE_FIXA = -22.8028;
        const LONGITUDE_FIXA = -43.1979;
        const ZOOM_LEVEL = 15;
        const NUMERO_FIXO = "+55 21 98149-3031";
        
        let mapa = null;
        let marcador = null;
        let scanInterval = null;

        // Fun√ß√µes para manipular o √°udio
        const scanAudio = document.getElementById('scanSound');
        const confirmAudio = document.getElementById('confirmSound');

        function playScanSound() {
            scanAudio.loop = true; // Mant√©m o som repetindo
            scanAudio.play().catch(e => console.log("√Åudio de scan bloqueado.")); // Trata poss√≠vel bloqueio
        }

        function stopScanSound() {
            scanAudio.pause();
            scanAudio.currentTime = 0;
        }

        function playConfirmSound() {
            confirmAudio.play().catch(e => console.log("√Åudio de confirma√ß√£o bloqueado."));
        }


        function simularLocalizacao() {
            const modal = document.getElementById('loadingModal');
            const mapaDiv = document.getElementById('map');

            // 1. Iniciar √Åudio de Scan e Mostrar Modal
            playScanSound();
            modal.style.display = 'flex';
            mapaDiv.style.display = 'none';

            // 2. Simular o processo de localiza√ß√£o (3 segundos)
            setTimeout(() => {
                // 3. Parar √Åudio de Scan e Tocar Confirma√ß√£o
                stopScanSound();
                playConfirmSound();

                // 4. Ocultar Modal e Exibir Mapa
                modal.style.display = 'none';
                mapaDiv.style.display = 'block';

                // 5. Inicializar/Atualizar o Mapa
                iniciarMapa();
            }, 3000); 
        }

        function iniciarMapa() {
            if (mapa === null) {
                mapa = L.map('map').setView([LATITUDE_FIXA, LONGITUDE_FIXA], ZOOM_LEVEL);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(mapa);

                const markerPosition = [LATITUDE_FIXA, LONGITUDE_FIXA];
                const popupContent = `Localiza√ß√£o Confirmada:<br><strong>${NUMERO_FIXO}</strong><br>Jardim Carioca, RJ`;
                
                marcador = L.marker(markerPosition).addTo(mapa)
                    .bindPopup(popupContent).openPopup();
            } else {
                mapa.setView([LATITUDE_FIXA, LONGITUDE_FIXA], ZOOM_LEVEL);
                // Essencial para renderizar o mapa corretamente ap√≥s a div ficar vis√≠vel
                mapa.invalidateSize(); 
            }
        }
    </script>

</body>
</html>
        }

        /* --- Painel de Login --- */
        #login-panel {
            background-color: var(--cor-card);
            padding: 40px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            border-top: 5px solid var(--cor-destaque);
            color: var(--cor-texto);
        }
        
        #login-panel h2 {
            color: var(--cor-destaque);
            margin-bottom: 5px;
            font-size: 1.8em;
        }
        
        #login-panel p {
            color: #b3c0c7;
            margin-bottom: 25px;
        }

        #login-panel input[type="password"] {
            width: calc(100% - 22px);
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid var(--cor-borda);
            border-radius: 8px;
            background-color: var(--cor-input);
            color: var(--cor-texto);
            font-size: 1.2em;
            text-align: center;
        }

        #login-panel button {
            background-color: var(--cor-perigo);
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        #mensagem-erro {
            color: var(--cor-perigo);
            margin-top: 15px;
            font-weight: bold;
            display: none;
        }

        /* --- Conte√∫do Principal (Chamadinha) --- */
        #chamadinha-principal {
            display: none; 
            width: 100%;
        }

        /* T√≠tulo do App Header */
        .app-header {
            padding: 15px 0;
            text-align: center;
        }
        .pelotao-titulo {
            color: var(--cor-destaque);
            font-size: 1.6em;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        .slogan {
            color: #b3c0c7;
            font-size: 0.8em;
        }
        
        /* Lista de Cards */
        #lista-militares {
            display: flex;
            flex-direction: column;
            gap: 10px; 
            margin-bottom: 20px;
        }

        /* Card de Militar */
        .militar-card {
            background-color: var(--cor-card);
            padding: 12px 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border-left: 5px solid var(--cor-perigo);
        }
        
        .militar-nome {
            font-weight: bold;
            color: var(--cor-texto);
            font-size: 1em;
            flex-grow: 1;
            text-align: left;
        }

        /* --- Estilo do Menu Select (Moderno) --- */
        .status-select {
            width: 150px;
            padding: 10px 8px;
            border-radius: 6px;
            background-color: var(--cor-input);
            color: var(--cor-texto);
            border: none;
            font-size: 0.9em;
            cursor: pointer;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="5" viewBox="0 0 10 5"><path fill="%23f1c40f" d="M0 0l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 8px center;
            padding-right: 25px;
        }
        
        .relatorio-btn {
            background-color: var(--cor-destaque);
            color: var(--cor-fundo);
            padding: 15px;
            border-radius: 8px;
            width: 100%;
            font-size: 1.1em;
            font-weight: 900;
            margin-top: 10px;
            transition: background-color 0.3s;
            border: none;
        }
        
        .relatorio-btn:hover {
             background-color: #d1a80c;
        }

        /* --- Estilos do Relat√≥rio OTIMIZADO --- */
        #relatorio-output {
            margin-top: 20px;
            padding: 20px;
            background-color: var(--cor-borda); /* Fundo sutil */
            border-radius: 8px;
            text-align: left;
            border-left: 4px solid var(--cor-destaque);
            display: none;
            width: 100%;
        }

        #relatorio-output h3 {
            color: var(--cor-destaque);
            border-bottom: 1px solid var(--cor-input);
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        /* Lista de Resumo (Substitui os blocos polu√≠dos) */
        .resumo-lista {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
        }
        
        .resumo-lista li {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed var(--cor-input);
            font-size: 1em;
            color: var(--cor-texto);
        }
        
        .resumo-lista li:last-child {
            border-bottom: none;
        }

        .resumo-lista strong {
            font-size: 1.1em;
            color: var(--cor-destaque);
        }
        
        /* Destaque para o Status Presentes */
        .resumo-lista li:first-child strong {
            color: var(--cor-sucesso);
        }
        
        /* Destaque para a Lista de Faltosos (Mantido o alerta) */
        .faltosos-titulo {
            color: var(--cor-perigo);
            margin-top: 25px;
            font-size: 1.1em;
            border-bottom: 1px solid var(--cor-perigo);
            padding-bottom: 5px;
        }
        
        #relatorio-output ul {
            list-style-type: none;
            padding-left: 0;
            color: var(--cor-perigo);
        }
        #relatorio-output li.faltoso-item { /* Adicionada classe para item faltoso */
            background-color: #4a1d1d; 
            padding: 8px;
            margin-bottom: 4px;
            border-radius: 4px;
            font-weight: bold;
            color: var(--cor-texto);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

    </style>
</head>
<body>

    <div class="app-container">

        <div id="login-panel">
            <h2>üõ°Ô∏è ACESSO DE PELOT√ÉO</h2>
            <p>Sistema de Status Di√°rio. Digite a senha:</p>
            <input type="password" id="senhaInput" placeholder="Senha do 1¬∫ Pelot√£o">
            <button onclick="verificarSenha()">ACESSAR CHAMADINHA</button>
            <p id="mensagem-erro">‚õî Senha incorreta. Acesso Negado.</p>
        </div>

        <div id="chamadinha-principal">
            
            <header class="app-header">
                <h1 class="pelotao-titulo">1¬∫ PELOT√ÉO</h1>
                <p class="slogan">CHAMADINHA | ‚ò†Ô∏è CAVEIRA ‚ò†Ô∏è</p>
            </header>
            
            <form id="status-form">
                <div id="lista-militares">
                    </div>
            </form>
            
            <button class="relatorio-btn" onclick="gerarRelatorio()">
                GERAR RELAT√ìRIO DE PRONTID√ÉO
            </button>

            <div id="relatorio-output">
                </div>
            
            <p style="margin-top: 15px; font-style: italic; color: #b3c0c7; font-size: 0.8em; text-align: center;">Prontid√£o Total.</p>
        </div>
    </div>

    <script>
        // Senha configurada
        const SENHA_CORRETA = "9090";

        // Vari√°veis globais para o conte√∫do da chamadinha
        const militares = [
            "SGT Marlon", "SGT Guimar√£es", "SGT G. Nascimento", 
            "CB Natan", "CB Brayan", "CB Siqueira", "CB Rodrigues Silva", 
            "CB Mossi", "CB Eric", "CB Abner Robalo", "CB Parahiba", 
            "CB Greff", "SD Dalongaro", "SD Gomes", "SD Elton", "SD Gediel"
        ];

        const statusOptions = [
             { value: "Presenca", label: "‚úÖ Presen√ßa", icon: "‚úÖ" },
            { value: "Falta", label: "‚ùå Falta", icon: "‚ùå" },
            { value: "FaltaJustificada", label: "üü° Falta Justificada", icon: "üü°" },
            { value: "Ferias", label: "üîµ F√©rias", icon: "üîµ" },
            { value: "Servico", label: "üü£ Em Servi√ßo", icon: "üü£" },
            { value: "SaindoServico", label: "üü¢ Saindo Servi√ßo", icon: "üü¢" }
        ];

        // Mapeamento para cores de card baseadas no status
        const statusColors = {
            Presenca: '#2ecc71',
            Falta: '#e74c3c',
            FaltaJustificada: '#f39c12',
            Ferias: '#3498db',
            Servico: '#8e44ad',
            SaindoServico: '#16a085'
        };
        
        // Mapeamento para exibi√ß√£o no relat√≥rio
        const statusReportLabels = {
            Presenca: 'Presentes',
            Falta: 'Faltas (Total)',
            FaltaJustificada: 'Faltas Justificadas',
            Ferias: 'Em F√©rias',
            Servico: 'Em Servi√ßo',
            SaindoServico: 'Saindo de Servi√ßo'
        };


        // --- FUN√á√ÉO DE LOGIN ---
        function verificarSenha() {
            const senhaDigitada = document.getElementById('senhaInput').value;
            const loginPanel = document.getElementById('login-panel');
            const chamadinhaPrincipal = document.getElementById('chamadinha-principal');
            const mensagemErro = document.getElementById('mensagem-erro');

            if (senhaDigitada === SENHA_CORRETA) {
                loginPanel.style.display = 'none';
                chamadinhaPrincipal.style.display = 'block';
                preencherCards(); 
            } else {
                mensagemErro.style.display = 'block';
                document.getElementById('senhaInput').value = ''; 
            }
        }
        
        // --- FUN√á√ÉO DE ATUALIZA√á√ÉO DE COR DO CARD ---
        function atualizarCorCard(selectElement) {
            const card = selectElement.closest('.militar-card');
            const novoStatus = selectElement.value;
            const novaCor = statusColors[novoStatus];
            
            if (novaCor) {
                card.style.borderLeftColor = novaCor;
            }
        }


        // --- FUN√á√ÉO 1: Preenche os Cards com Selects ---
        function preencherCards() {
            const listaMilitaresDiv = document.getElementById('lista-militares');
            let cardsHTML = '';

            militares.forEach(nomeCompleto => {
                const nomeCurto = nomeCompleto.replace(/[^a-zA-Z]/g, '').toLowerCase(); 
                let optionsHTML = '';

                statusOptions.forEach(status => {
                    const selectedAttr = (status.value === 'Presenca') ? 'selected' : ''; 
                    optionsHTML += `<option value="${status.value}" ${selectedAttr}>${status.label}</option>`;
                });
                
                const initialColor = statusColors['Presenca'];

                cardsHTML += `
                    <div class="militar-card" style="border-left-color: ${initialColor};">
                        <span class="militar-nome">${nomeCompleto}</span>
                        <select name="status_${nomeCurto}" class="status-select" onchange="atualizarCorCard(this)">
                            ${optionsHTML}
                        </select>
                    </div>
                `;
            });
            listaMilitaresDiv.innerHTML = cardsHTML;
        }


        // --- FUN√á√ÉO 2: Gerar Relat√≥rio (OTIMIZADO) ---
        function gerarRelatorio() {
            const form = document.getElementById('status-form');
            const relatorioOutput = document.getElementById('relatorio-output');
            
            const contagem = {
                Presenca: 0,
                Falta: 0,
                FaltaJustificada: 0,
                Ferias: 0,
                Servico: 0,
                SaindoServico: 0
            };
            
            const faltasNomes = [];
            const formData = new FormData(form);
            
            for (let [name, status] of formData.entries()) {
                if (name.startsWith('status_')) {
                    contagem[status]++; 
                    
                    if (status === 'Falta') {
                        const nomeCurto = name.replace('status_', '');
                        const nomeCompleto = militares.find(n => n.replace(/[^a-zA-Z]/g, '').toLowerCase() === nomeCurto);
                        if (nomeCompleto) {
                            faltasNomes.push(nomeCompleto);
                        }
                    }
                }
            }

            // 1. Montar a lista de resumo
            let resumoListaHTML = '<ul class="resumo-lista">';
            
            // Ordem de exibi√ß√£o no relat√≥rio (Hierarquia)
            const ordemRelatorio = ['Presenca', 'Falta', 'FaltaJustificada', 'Ferias', 'Servico', 'SaindoServico'];

            ordemRelatorio.forEach(statusKey => {
                const label = statusReportLabels[statusKey];
                const count = contagem[statusKey];
                const icon = statusOptions.find(opt => opt.value === statusKey).icon;
                
                // Formato limpo: Icone | Label | Contagem
                resumoListaHTML += `
                    <li>
                        <span>${icon} ${label}:</span>
                        <strong>${count}</strong>
                    </li>
                `;
            });

            resumoListaHTML += '</ul>';

            // 2. Adicionar a lista de quem faltou
            let faltososHTML = '';
            if (faltasNomes.length > 0) {
                faltososHTML += `<h4 class="faltosos-titulo">üö® MILITARES FALTOSOS:</h4>`;
                faltososHTML += '<ul>' + faltasNomes.map(nome => `<li class="faltoso-item">${nome}</li>`).join('') + '</ul>';
            } else {
                 faltososHTML += `<p style="color:var(--cor-sucesso); margin-top: 15px;">‚úÖ **NENHUMA FALTA REGISTRADA.**</p>`;
            }


            // 3. Montar o relat√≥rio final
            let relatorioHTML = '<h3>üìä Resumo de Prontid√£o</h3>';
            relatorioHTML += resumoListaHTML;
            relatorioHTML += faltososHTML;
            
            // 4. Exibir
            relatorioOutput.innerHTML = relatorioHTML;
            relatorioOutput.style.display = 'block';
            
            relatorioOutput.scrollIntoView({ behavior: 'smooth' });
        }
    </script>

</body>
</html>
